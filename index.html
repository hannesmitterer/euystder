<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZeppBamboo: Bauphasen im Sudan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="languages.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom right, #f8f9fa, #e9ecef);
            color: #343a40;
        }
        .phase-card {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            transform: translateY(0);
        }
        .phase-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 20px rgba(0, 0, 0, 0.15);
        }
        /* Fade-in animation for cards */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .phase-card.animate-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        
        /* Language Navigator Styles */
        .language-navigator {
            font-family: 'Inter', sans-serif;
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .lang-option:hover {
            background-color: #f3f4f6;
        }
        
        .language-display {
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
    </style>
    <!-- Firebase SDKs laden -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        setLogLevel('debug');
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // Initialize Language Navigator
        let languageNavigator;
        
        function initializeLanguageNavigator() {
            languageNavigator = new LanguageNavigator('language-navigation', {
                defaultLanguage: 'de', // Current app is in German
                onLanguageChange: (language) => {
                    console.log('Language changed to:', language);
                    // Here you could implement actual language switching logic
                    // For now, we'll just log the change and potentially update the UI
                    updatePageLanguage(language);
                }
            });
        }
        
        /**
         * Update page language and content
         * This is a placeholder for actual internationalization
         */
        function updatePageLanguage(language) {
            // Update the html lang attribute
            document.documentElement.lang = language.code;
            
            // Update text direction for RTL languages
            document.documentElement.dir = language.rtl ? 'rtl' : 'ltr';
            
            // Show language change notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            notification.innerHTML = `
                <div class="flex items-center">
                    <span>Language changed to: <strong>${language.name}</strong></span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">×</button>
                </div>
            `;
            document.body.appendChild(notification);
            
            // Auto-remove notification after 3 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 3000);
        }
        
        // Initialize Firebase (variables already declared above)
        // const app = initializeApp(firebaseConfig);
        // const db = getFirestore(app);
        // const auth = getAuth(app);

        // Sign in anonymously or with custom token
        if (initialAuthToken) {
            signInWithCustomToken(auth, initialAuthToken).catch((error) => {
                console.error("Firebase Auth Error:", error);
                signInAnonymously(auth);
            });
        } else {
            signInAnonymously(auth);
        }

        // Wait for auth to be ready
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                const userId = user.uid;
                document.getElementById('user-id').textContent = userId;
                document.getElementById('loading').style.display = 'none';
                
                // Initialize Language Navigator after auth is ready
                initializeLanguageNavigator();

                const docRef = doc(db, `artifacts/${appId}/public/data/zeppBamboo`);

                // Listen for real-time updates
                onSnapshot(docRef, (doc) => {
                    if (doc.exists()) {
                        const data = doc.data();
                        renderPhases(data.phases || []);
                    } else {
                        // Document doesn't exist, maybe create it with initial data
                        const initialPhases = [
                            {
                                id: 1,
                                title: "Phase 1: Fundament und Auftrieb",
                                img: "https://gemini-generated-images.s3.us-west-1.amazonaws.com/generated/image-1718131362098-33621455-9b2f-412e-a50e-b873528b7e8d.png",
                                alt: "Phase 1 - Fundamentbau mit Bambus und Plastikkanistern",
                                text: "Ein Team von Bauenden errichtet die grundlegende Bambusgitterstruktur auf festem Boden nahe eines Gewässers. Recycelte Plastikkanister und Fässer, die vor Ort gesammelt wurden, werden sorgfältig in die Bambusrahmen eingearbeitet und verschnürt, um die Auftriebskörper zu bilden. Traditionelle Seil- und Bambusverbindungstechniken sind sichtbar, die von erfahrenen Handwerkern angewendet werden, während die Gemeinschaft hilft, die Materialien zu sammeln und vorzubereiten."
                            },
                            {
                                id: 2,
                                title: "Phase 2: Struktur und Plattformmontage",
                                img: "https://storage.googleapis.com/uploaded-file-references/zpabamboo4.jpg",
                                alt: "Phase 2 - Montage der Grundstruktur auf dem Wasser",
                                text: "Die schwimmende Plattform ist nun im Wasser positioniert und wird stabilisiert. Arbeiter beginnen damit, die vertikalen Bambusstützen und den Rahmen für die erste Ebene der Gebäude zu errichten. Die Plattform ist mit einer Verankerung gesichert, während andere Elemente wie Lehmziegel und Schilfrohrmatten für Wände und Dächer vorbereitet werden. Es herrscht reger Betrieb, während die Gemeinschaft zusammenarbeitet, um die Struktur weiter aufzubauen."
                            },
                            {
                                id: 3,
                                title: "Phase 3: Dachkonstruktion und integrierte Systeme",
                                img: "https://storage.googleapis.com/uploaded-file-references/zpabamboo3.jpg",
                                alt: "Phase 3 - Bau des Daches und Aquaponik-Systeme",
                                text: "Die Bambusrahmen für die Gebäude sind weitgehend fertiggestellt. Arbeiter sind dabei, Dächer aus Schilf und getrocknetem Lehm zu montieren, die sowohl Schutz als auch natürliche Isolierung bieten. Eine wichtige Neuerung sind die integrierten Aquaponik-Systeme: Auf einer der Plattformen sind erste Pflanzbeete sichtbar, die in Verbindung mit einem Fischzuchtbecken stehen, um eine nachhaltige Nahrungsmittelproduktion zu ermöglichen. Weiterhin sind Vorbereitungen für einfache Regenwassersammelsysteme zu erkennen, die Wasser von den Dächern in Behälter leiten sollen."
                            },
                            {
                                id: 4,
                                title: "Phase 4: Energie- und Wasserautonomie",
                                img: "https://gemini-generated-images.s3.us-west-1.amazonaws.com/generated/image-1718131362098-33621455-9b2f-412e-a50e-b873528b7e8d.png",
                                alt: "Phase 4 - Solaranlage und Wassersammlung",
                                text: "Die Grundstruktur der ersten Hütte ist weitgehend abgeschlossen, und die 'ZeppBamboo'-Siedlung macht einen großen Schritt in Richtung Autarkie. Auf dem Dach der Hütte ist eine kleine Photovoltaikanlage sichtbar, die erste Solarenergie für die Bewohner erzeugen wird. Direkt daneben befindet sich ein einfaches Regenwassersammelsystem, das Wasser in einen großen, auf der Plattform montierten Tank leitet. Ein niedrigtechnologisches Filtersystem, möglicherweise aus Schichten von Sand und Kies, ist neben dem Tank angebracht, um das gesammelte Wasser zu reinigen. Die Aquaponik-Beete gedeihen bereits, und die Gemeinschaft arbeitet weiterhin Hand in Hand."
                            },
                            {
                                id: 5,
                                title: "Phase 5: Fertigstellung und Dockmöglichkeiten",
                                img: "https://storage.googleapis.com/uploaded-file-references/zpabamboo5.jpg",
                                alt: "Phase 5 - Dock und Pflanzen",
                                text: "Die erste ZeppBamboo-Einheit ist fast vollständig bewohnt, mit befestigten Wänden und weiteren Innenausbauten. Eine einfache, aber robuste Docking-Möglichkeit aus Bambus und recyceltem Holz ist an die schwimmende Plattform angefügt. Sie ermöglicht kleinen Booten das sichere Anlegen und dient als Einstiegspunkt zur Struktur. Weitere grüne Elemente wie Pflanzen und kleine Bäume sind auf der Plattform angepflanzt, was die Lebensqualität erhöht und Schatten spendet. Die Photovoltaik-Anlage und das Wassersystem sind voll funktionsfähig, und die Aquaponik-Beete tragen erste Ernten."
                            },
                            {
                                id: 6,
                                title: "Phase 6: Bioversharmony und Gemeinschaftsleben",
                                img: "https://storage.googleapis.com/uploaded-file-references/zpabamboo6.jpg",
                                alt: "Phase 6 - Bioversharmony und Gemeinschaftsleben",
                                text: "Die ZeppBamboo-Einheit ist nun vollständig bewohnt und bildet einen blühenden Mikrokosmos. Mehrere modulare Einheiten wurden miteinander verbunden und bilden eine kleine schwimmende Gemeinschaft. Die Oberflächen sind mit einer Fülle von einheimischen Pflanzen und Gemüsegärten bedeckt, die nicht nur Nahrung liefern, sondern auch die Biodiversität anziehen. Im Wasser unter und um die Plattform herum sind einfache Netze oder Strukturen angebracht, die als Laichgebiete und Schutzräume für Fische dienen, wodurch ein florierendes Ökosystem gefördert wird. Kinder spielen sicher auf den Plattformen, und kleine Boote bewegen sich friedlich zwischen den Einheiten."
                            },
                            {
                                id: 7,
                                title: "Phase 7: Zepp-Integration und Mobilität",
                                img: "https://gemini-generated-images.s3.us-west-1.amazonaws.com/generated/image-1718131362098-33621455-9b2f-412e-a50e-b873528b7e8d.png",
                                alt: "Phase 7 - Zepp-Integration und Mobilität",
                                text: "Die namensgebenden Zeppeline werden in das Projekt integriert. Kleinere, mit Biogas betriebene Bambus-Zepp-Module dienen zur Mobilität und Erkundung. Ein Start- und Landeplatz aus Bambus wird gebaut, um die schwebenden Zepp-Module aufzunehmen. Diese Zeppeline ermöglichen es den Mitgliedern der ZeppBamboo-Siedlung, die umliegenden Gebiete zu erkunden, Ressourcen zu transportieren und andere Gemeinschaften zu erreichen, ohne die Wasserwege zu verlassen."
                            },
                            {
                                id: 8,
                                title: "Phase 8: Echodemokratie und Governance",
                                img: "https://gemini-generated-images.s3.us-west-1.amazonaws.com/generated/image-1718131362098-33621455-9b2f-412e-a50e-b873528b7e8d.png",
                                alt: "Phase 8 - Echodemokratie und Governance",
                                text: "Die ZeppBamboo-Gemeinschaft etabliert formelle echodemokratische Strukturen für die kollektive Entscheidungsfindung. Die schwimmenden Inseln werden so umgestaltet, dass sie einen zentralen Versammlungsplatz für demokratische Sitzungen beherbergen. Entscheidungen über Ressourcenmanagement, die Nutzung erneuerbarer Energien und die Expansion der Siedlung werden gemeinsam getroffen. Die ZeppBamboo-Siedlung wird zu einem Modell für eine nachhaltige und selbstverwaltete Gemeinschaft, die auf den Prinzipien der ökologischen und sozialen Harmonie beruht."
                            },
                            {
                                id: 9,
                                title: "Phase 9: Regionaler Hub und Advanced Circularity",
                                img: "https://gemini-generated-images.s3.us-west-1.amazonaws.com/generated/image-1718131362098-33621455-9b2f-412e-a50e-b873528b7e8d.png",
                                alt: "Phase 9 - Regionaler Hub und Advanced Circularity",
                                text: "Die ZeppBamboo-Siedlung hat sich zu einem vitalen regionalen Hub auf dem Wasser entwickelt. Mehrere große, miteinander verbundene schwimmende Inseln bilden ein geschäftiges Netzwerk von Häusern, Gemeinschaftseinrichtungen und spezialisierten Produktionszonen. Fortgeschrittene Prinzipien der Kreislaufwirtschaft sind vollständig integriert: Neben Aquaponik und Regenwassernutzung sind spezialisierte Einheiten für Abfalltrennung, Materialrecycling und organische Kompostierung sichtbar. Größere Zeppeline, die Fracht oder größere Personengruppen transportieren, verbinden dieses zentrale Drehkreuz mit kleineren ZeppBamboo-Außenposten oder Festlandgemeinschaften, was den Handel, die Bildung und den Ressourcenaustausch erleichtert."
                            },
                            {
                                id: 10,
                                title: "Phase 10: Globale Verbreitung und Wissensaustausch",
                                img: "https://gemini-generated-images.s3.us-west-1.amazonaws.com/generated/image-1718131362098-33621455-9b2f-412e-a50e-b873528b7e8d.png",
                                alt: "Phase 10 - Globale Verbreitung und Wissensaustausch",
                                text: "ZeppBamboo ist nun eine globale Bewegung, die ihr Wissen und ihre Technologie mit Gemeinschaften auf der ganzen Welt teilt. Die ursprüngliche Siedlung dient als globales Hauptquartier für die 'Echodemokratie'-Bewegung. Seminare und Workshops werden abgehalten, um die ZeppBamboo-Technologie in anderen Ländern mit ähnlichen Herausforderungen zu replizieren. Zeppeline transportieren jetzt nicht nur Waren und Menschen, sondern auch Lehrer, Ingenieure und Gemeinschaftsleiter, um das Wissen über nachhaltiges Wohnen und demokratische Governance in der gesamten Welt zu verbreiten."
                            }
                        ];
                        setDoc(docRef, { phases: initialPhases }).catch(e => console.error("Error setting initial document:", e));
                    }
                }, (error) => {
                    console.error("Firestore onSnapshot error:", error);
                });
            } else {
                console.log("Not authenticated yet.");
            }
        });

        // Save function
        window.saveDocument = async () => {
            const userId = auth.currentUser?.uid || "anonymous";
            const docRef = doc(db, `artifacts/${appId}/public/data/zeppBamboo`);
            
            const phases = [];
            document.querySelectorAll('.phase-card').forEach((card, index) => {
                const title = card.querySelector('h2').textContent;
                const img = card.querySelector('img').src;
                const alt = card.querySelector('img').alt;
                const text = card.querySelector('p').textContent;
                phases.push({ id: index + 1, title, img, alt, text });
            });
            
            try {
                await setDoc(docRef, { phases, lastUpdatedBy: userId, lastUpdated: new Date() });
                document.getElementById('save-status').textContent = 'Gespeichert!';
                setTimeout(() => document.getElementById('save-status').textContent = '', 3000);
            } catch (e) {
                console.error("Fehler beim Speichern des Dokuments: ", e);
                document.getElementById('save-status').textContent = 'Fehler beim Speichern!';
            }
        };

        function renderPhases(phases) {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = '';
            phases.forEach((phase, index) => {
                const card = document.createElement('div');
                card.className = 'phase-card p-6 animate-in';
                card.style.animationDelay = `${index * 0.1}s`;
                card.innerHTML = `
                    <h2 class="text-3xl font-bold mb-4 text-gray-700" contenteditable="true">${phase.title}</h2>
                    <img src="${phase.img}" alt="${phase.alt}" class="w-full h-auto object-cover rounded-lg mb-4 shadow-md">
                    <p class="text-gray-700" contenteditable="true">${phase.text}</p>
                `;
                mainContent.appendChild(card);
            });
        }
    </script>
</head>
<body class="p-4 md:p-8">
    <header class="text-center py-12 px-4">
        <h1 class="text-5xl md:text-6xl font-bold text-gray-800 mb-2 tracking-tight">ZeppBamboo Bauphasen</h1>
        <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">Die Vision erreicht die DeepAuraHarmony Stage: Eine Reise der Nachhaltigkeit, Schritt für Schritt.</p>
        <div class="mt-4 text-gray-500 text-sm">
            <p>Ihre Benutzer-ID: <span id="user-id" class="font-mono font-bold text-gray-700">Laden...</span></p>
            <p class="mt-2 text-green-600" id="save-status"></p>
        </div>
        <button onclick="saveDocument()" class="mt-6 px-6 py-3 bg-indigo-600 text-white rounded-full font-bold shadow-lg hover:bg-indigo-700 transition duration-300">
            Speichern und Teilen
        </button>
    </header>

    <!-- Language Navigation Component -->
    <div class="max-w-4xl mx-auto mb-8">
        <div id="language-navigation"></div>
    </div>

    <main id="main-content" class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <p id="loading" class="text-center text-lg text-gray-500 col-span-full">Lade Inhalt...</p>
    </main>

    <footer class="text-center py-8 text-gray-500">
        <p>&copy; 2023 ZeppBamboo-Projekt. Alle Rechte vorbehalten.</p>
    </footer>

</body>
</html>
